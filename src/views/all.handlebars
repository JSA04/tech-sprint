<h2 class="mb-3">Todas as Ideias</h2>

{{#if ideas.length}}
  <div class="d-flex justify-content-end mb-3">
    <a href="/ideas/new" class="btn btn-primary">+ Nova Ideia</a>
  </div>
  <div class="row g-3">
    {{#each ideas}}
      <div class="col-12 col-sm-6 col-lg-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between">
              <h5 class="card-title mb-2">{{this.title}}</h5>
              <span>{{this.voteScore}} pontos de votos</span>
            </div>
            <div class="mb-2 text-muted">
              {{#if (eq @root.user.id this.creator.id)}}
                <span class="badge badge-owned">Criada por vocÃª</span>
              {{/if}}
              <span class="badge text-bg-secondary">{{this.category.name}}</span>
            </div>              
            <p class="card-text text-truncate-3">{{this.description}}</p>
            <div class="small text-muted d-flex align-items-center gap-2">
              Criada por: {{this.creator.name}} em {{formatDate this.createdAt}}
            </div>

            <!-- BotÃµes de aÃ§Ãµes -->
            <h6 class="text-secondary fw-bold mt-2">AÃ§Ãµes</h6>
            <div class="d-flex flex-nowrap gap-2 align-items-center">
              <a href="/ideas/{{this.id}}" class="btn btn-primary btn-sm">ğŸ‘ï¸</a>
              {{#if (eq @root.user.id this.creator.id)}}
                <a href="/ideas/{{this.id}}/edit" class="btn btn-warning btn-sm">âœï¸</a>
                <form class="d-inline-block m-0 flex-shrink-0" action="/ideas/{{this.id}}/delete" method="POST">
                  <input type="hidden" name="_csrf" value="{{../csrfToken}}">
                  <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘ï¸</button>
                </form>
              {{/if}}
            </div>

            <!-- BotÃµes de voto (sempre visÃ­veis; bloqueados quando a ideia Ã© do prÃ³prio usuÃ¡rio) -->
            <h6 class="text-secondary fw-bold d-flex align-items-end gap-2 mt-2">
              Votos
              {{#if this.userAgreed}}
                <span class="text-success fw-normal fs-7">(vocÃª votou a favor)</span>
              {{else if this.userDisagreed}}
                <span class="text-danger fw-normal fs-7">(vocÃª votou contra)</span>
              {{/if}}
            </h6>
            <div class="d-flex align-items-center gap-2">
              <form action="/votes" method="POST" class="d-inline">
                <input type="hidden" name="_csrf" value="{{../csrfToken}}">
                <input type="hidden" name="ideaId" value="{{this.id}}">
                <input type="hidden" name="voteType" value="agree">
                <button type="submit" class="btn btn-success btn-sm {{#if (or (eq @root.user.id this.creator.id) this.userAgreed)}}blocked{{/if}}">ğŸ‘</button>
              </form>

              <form action="/votes" method="POST" class="d-inline">
                <input type="hidden" name="_csrf" value="{{../csrfToken}}">
                <input type="hidden" name="ideaId" value="{{this.id}}">
                <input type="hidden" name="voteType" value="disagree">
                <button type="submit" class="btn btn-danger btn-sm {{#if (or (eq @root.user.id this.creator.id) this.userDisagreed)}}blocked{{/if}}">ğŸ‘</button>
              </form>

              {{#if (or this.userAgreed this.userDisagreed)}}
                <form action="/votes/clear" method="POST" class="d-inline">
                  <input type="hidden" name="_csrf" value="{{../csrfToken}}">
                  <input type="hidden" name="ideaId" value="{{this.id}}">
                  <button type="submit" class="btn btn-primary btn-sm">ğŸ”„</button>
                </form>
              {{/if}}
            </div>
          </div>
        </div>
      </div>
    {{/each}}
  </div>
{{else}}
  <div class="empty-state">
    <p>ğŸ‰ Nenhuma ideia cadastrada. Que tal criar uma nova?</p>
    <a href="/ideas/new" class="btn btn-primary">Criar Primeira Ideia</a>
  </div>
{{/if}}